# 現状の設計 (As-Is)

## 1. システム概要

このシステムは、食販イベントにおける注文から調理、商品受け渡しまでを管理・効率化するためのWebアプリケーション群である。
主に以下の3つの画面から構成されており、それぞれ役割が異なる。

- **調理室画面 (`index.html`)**: 特定のクラス（調理場所）の調理担当者向け。調理すべき注文と数量をリアルタイムで確認する。
- **受け渡し画面 (`mc.html`)**: 店舗の受け渡し担当者向け。調理が完了した注文を管理し、顧客への受け渡しを記録する。
- **総合操作盤 (`sosa.html`)**: 全体の管理者向け。複数クラスの状況を俯瞰し、注文データの編集や調理プロセスの進行管理を行う。

## 2. 機能一覧

### 共通機能
- **ログイン**: 各画面はパスワード認証によって保護されている。認証トークンを取得し、以降のAPI通信で使用する。
- **リアルタイム更新**: 定期的にAPIサーバーにポーリングを行い、注文データの変更を検知して画面に反映する。

### 調理室画面 (`index.html`)
- 担当クラスの注文を時系列でテーブル表示する。
- ステータスが「調理中」の注文をハイライト表示する。
- 調理が必要な商品（フレーバーごと）の合計数量を表示する。

### 受け渡し画面 (`mc.html`)
- 「調理待ち」ステータスの注文を注文番号ごとにグリッド表示する。
- 注文番号をタップするとモーダルが開き、「受け渡し済み」にステータスを更新できる。

### 総合操作盤 (`sosa.html`)
- 複数のクラス（1組, 5組, 6組）の注文状況をそれぞれ独立したパネルで一覧表示する。
- 各注文のステータス（呼び出し待ち, 調理中, 調理済みなど）を色分けして表示する。
- **調理完了操作**: 「調理完了」ボタンを押すことで、現在「調理中」の注文を「調理済み」に一括更新し、次の「調理待ち」注文を「調理中」に引き上げる。
- **注文データ操作**:
    - 注文の追加、編集、削除。
    - 注文のステータスを手動で変更。
- 表示順序の切り替え（ID順 / ステータス順）。

## 3. データフローとアーキテクチャ

- **クライアントサイド**:
    - フロントエンドはフレームワークを使用しない素のHTML, CSS, JavaScriptで実装されている。
    - `fetch` APIを用いて、バックエンドAPIと非同期に通信（HTTPリクエスト）する。
    - 1秒ごとにAPIの`/check`エンドポイントをポーリングし、差分データを取得して画面を更新する。
- **バックエンド (APIサーバー)**:
    - 本番環境は `https://api.yaakiyu.f5.si/`、開発環境は `http://localhost/` に存在する。
    - 認証、注文データの取得・更新など、すべてのデータ操作はAPI経由で行われる。
    - 主なエンドポイント:
        - `/login`: 認証を行い、トークンを発行する。
        - `/log_all`: 全ての注文履歴を取得する。
        - `/check`: 前回のチェック以降に更新された注文データを取得する。
        - `/change_status`: 単一の注文ステータスを更新する。
        - `/change_status_multi`: 複数の注文ステータスを一括で更新する。

## 4. 画面仕様

### 調理室画面
- **レイアウト**: 2カラム構成。左に注文テーブル、右に調理待ち商品の総数サマリー。
- **特徴**:
    - 調理中の注文行は赤くハイライトされる。
    - 支払い済みでない（調理対象でない）注文は薄く表示される。

### 受け渡し画面
- **レイアウト**: グリッドレイアウト。調理待ちの注文がカードとして並ぶ。
- **操作**: カードをタップすると確認モーダルが表示され、「はい」を押すと受け渡し完了となる。

### 総合操作盤
- **レイアウト**: 3カラムのグリッドレイアウト。各カラムが1つのクラスに対応するパネルとなっている。
- **特徴**:
    - 注文ステータスに応じて行の背景色が変化する（例: 調理中は赤系、調理済みは緑系）。
    - 「調理完了」ボタンを押すと、調理サイクルの進行を管理できる。
    - 「他の操作」ボタンから、注文のCRUD（作成・読み取り・更新・削除）操作モーダルを開くことができる。
